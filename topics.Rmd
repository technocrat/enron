---
title: "Topic Extraction"
author: "Richard Careaga"
date: "March 9, 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(broom)
library(GGally)
library(here)
library(pander)
library(pdftools)
library(slam)
library(tidyr)
library(tidytext)
library(tidyverse)
library(tm)
library(topicmodels)
load("g_enron.Rda")

# Mon Mar 11 21:55:19 2019 ------------------------------
# uri <- here("sources/wolak.pdf")
# engine <- "pdftools"
# rseader <- readPDF(engine)
# wolak_text <- reader(elem = list(uri = uri), language = "en", id = "id1")$content # discard metadata
# See supplemental script wolak_scrub.R for operations
# to clean wolak_text for topic analysis as a single document
# rather than as a collection of documents (one per page).
# saved as wolak_clean.Rda

load("wolak_clean.Rda")

wolak <- VectorSource(wolak_clean)
w_corpus <- VCorpus(wolak)
w_corpus <- tm_map(w_corpus, removeWords, stopwords("english"))
w_corpus <- tm_map(w_corpus, removeNumbers)
#save(w_corpus, file = "w_corpus.Rda")
w_dtm <- DocumentTermMatrix(w_corpus)
removeSparseTerms(w_dtm, 0.2)
#save(w_dtm, file = "w_dtm.Rda")
findFreqTerms(w_dtm, 5)
# ff ch 6 of tt
w_lda <- LDA(w_dtm, control = list(seed = 2203), k = 6)
w_topics <- tidy(w_lda, matrix = "beta")
w_top_terms <- w_topics %>%
  group_by(topic) 	  	%>%
  top_n(15, beta) 		  %>%
  ungroup() 			      %>%
  arrange(topic, -beta)
```

### Email discovery in litigation

Rule 34 of [The Federal Rules of Civil Procedure] permits parties to civil litigation to require opposing parties and, in some cases, third parties, to produce evidence or materials likely to lead to the production of evidence that is stored in electronic form. Regulatory and law enforcement agencies can also require or subpoena electronic information, including email. Given the adverse interests, time and cost constraints, and the sheer volume of electronic records, including email, both sides struggle with making the process manageable. The civil courts require parties to engage in a cooperative process (see the [Sedona Conference] Report, the report of the [Advisory Committee] on the most recent changes to Rule 34 and the [ESI Guidelines] and [ESI Checklist] issued by the U.S. District Court for the Northern District of California).

Among the questions of greatest important is how to separate the relevant content from the large universe of what is available. For that, participants usually turn to search terms -- keywords and phrases. (*See* recent article pointing [keyword limitations] on effective discovery.)

As the author of the [keyword limitations] article points out, words have synonmyms, private meanings, multiple meanings and meanings that depend critically on context. Less appreciated, perhaps, is that most people fail to distinguish between styles of language. While it's easy to tell the difference between an inaugeral address and a sports color commentator's styles in oral communication and to distinguish a scientific paper from a young adult novel in formal written conversation, email falls in the  separate sphere of informal written language.^[*See* [McWhorter].]

> Reading email is eavesdropping.


### Information sought

Prior to the investigation that resulted in the an initial staff report, FERC received a report from the California agency responsible for operating the electric energy exchange that FERC was concerned that the market had been manipulating.^[Frank A. Wolak, Chairman, Market Surveillance Committee of California Independent System Operator, *Report on Redesign of California Real-Time Energy and Ancillary Services Markets* dated October 18, 1999], which will be referred to as the [Wolak report].

The [Wolak report] was prepared before FERC began its investigation, did not rely on the Enron email corpus^[The report does not even name Enron.] and provides a lengthy analysis of the indicia of the exercise of market power in the California electricity wholesale market. A topical and keyword digest was prepared, as discussed below, to identify subjects of interest in the corpus.

#### Wolak keywords and topics

A latent Dirichlet allocation model specifying classification into six topics was prepared for the [Wolak Report]. As descibed in the [classic paper] by David Blei, Andrew Ng and Michael Jordan, *Latent Dirichlet Allocation* (*J. Machine Learning Res.* 3 (2003). 993-1022), this machine learning technique is a generative probabalistic model. Each discrete object in a collectikon (such as words in a document) is "modeled as a finixed mixture over an underlying sete of topics" (*id.*). Topics on the other hand are "modeled as an infinite mixture over an underlying set of topic probabilities." (*id.*) A list of some of the keywords in each modeled topic are

```{r}
pander(w_top_terms)
w_top_terms 							%>%
  mutate(term = reorder(term, beta)) 	%>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) 				+
  facet_wrap(~ topic, scales = "free") 			+
  coord_flip()
```

What is immediately striking is that the same word, such as *market* may belong to every topic. Other words, *PG&E, hydro,* and *divestiture* are found only in one topic. A combination of keywords and topics will be derived from the Enron dataset and commonalities will be sought.



[The Federal Rules of Civil Procedure]:https://www.uscourts.gov/sites/default/files/cv_rules_eff._dec._1_2018_0.pdf

[McWhorter]:https://www.ted.com/talks/john_mcwhorter_txtng_is_killing_language_jk?language=en

[Sedona Conference]:https://thesedonaconference.org/download-publication?fid=2978

[ESI Guidelines]:https://www.cand.uscourts.gov/eDiscovery
Guidelines

[Advisory Committee]:https://www.uscourts.gov/rules-policies/archives/committee-reports/advisory-committee-rules-civil-procedure-may-2014

[ESI Checklist]:https://www.cand.uscourts.gov/eDiscoveryGuidelines

[keyword limitations]:http://www.neworleansbar.org/news/committees/relying-on-keyword-search-for-e-discovery-it-may-harm-your-case

[classic paper]:http://www.jmlr.org/papers/volume3/blei03a/blei03a.pdf
